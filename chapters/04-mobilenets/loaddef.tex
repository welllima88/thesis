%!TEX root = ../../dissertation.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Mobile Core Network Load}
\label{c4:sec:loaddefinition}

Now that both the basic architecture and protocols have been introduced and related work presented, a specific perspective on the \gls{CN} control plane can be defined. Existing core network measurement studies look at the control plane mostly in a rather incoherent manner. Some aspects are singled out and presented without regarding the bigger picture. In this thesis, the driving question for this research aspect is core network load. This section attempts to define a load metric 
% oder "load metrics"?
in this context. Following afterwards is a discussion of potential factors that could influence load.


%%
\subsection{Load Definition}

A traditional 
% [Citation available]?
definition of link load $\rho_{l}$ 
% Auch: utilization
is the ratio of the used bandwidth $b_u$ versus the available bandwidth $b_a$ on a link,

\begin{equation}
	\phantom{.}\rho_{l} = \frac{b_{u}}{b_{a}}\text{.}
\end{equation}

The network load $\rho_{N}$ can then simply be defined as the average load of all involved links,

\begin{equation}
	\phantom{.}\rho_{N} = \frac{\sum_{i \in N} \rho_{l,i}}{|N|}\text{.}
% i in N --> N ist eine Menge --> |N| als deren Kardinalität
\end{equation}

% Sollte man hier erwähnen, dass das rein die User Plane Load ist? Später, in der Gleichung mit dem max, gehen ja dann auch CP-Lasten mit ein.

However, the link itself is not the only component that has a limited capacity and thus can experience load. A link's capacity is determined by the transmission speed of the interfaces of the two involved network nodes. 
% Wenn die Absolutgeschwindigkeit auch wichtig ist, warum halten wir uns dann mit der relativen Last auf? Ist rho_i=100% > rho_j=100%, wenn i eine vielfache Kapazität von j hat?
% Oder sollte da stehen, "Other load metrics might be defined using different limited / scarce resources as well: ...." (so wie im Endeffekt im Folgenden).
Any involved node has also other limiting factors, mostly related to the available memory, processing power, or some other resource with fixed capacity.

In Internet core routers those other factors are mostly well known and researched. 
% [Citation available]?
The main functionality of routers is to forward packets on the basis of a routing table. This table is generated by exterior and interior gateway protocols, usually \gls{BGP} in conjunction with \gls{RIP} or \gls{OSPF}, and may grow rather large. 
% [Citation available]? Oder eine Abschätzung wenigstens? \mathscr{O}(alle IPv4-Adressen + bislang zugeteilte v6) oder so, um's mal großzügig zu machen?
The generation and maintenance of a routing table including all lookups --- which might be expensive in a large table --- incurs load on the router's available memory and processing capacity. This kind of load can be attributed to the router's control plane and occurs in addition to the user plane packet forwarding load. Still, the Internet's control plane is rather lightweight and isolated. Only minimal state is kept where necessary.
% Ich würde sogar sagen, it was designed to be lightweight / use little distributed state / ...

The situation is different in a mobile network. Here, the control and user plane are tightly coupled as discussed in Section~\ref{c4:sec:3gpparchitecture}.  Therefore, load of individual resources cannot be looked at separately anymore, and a node will be limited by any one of these resources. The load of any particular mobile core network node $\rho_{n}$ 
% Würde ja persönlich "j" als Index für den Node verwenden, um nicht mit "N" von vorher ins Gehege zu kommen.
could then be defined as the maximum of the node's link load $\rho_{l,n}$, memory load $\rho_{m,n}$, and processing load $\rho_{p,n}$,

\begin{equation}
	\phantom{,}\rho_{n} = \max(\rho_{l,n}, \rho_{m,n}, \rho_{p,n})\text{.}
\end{equation}
% (Indizes repariert, sodass sie mit der Definition von \rho_N zusammenpassen)

The \gls{CN} load $\rho_{CN}$ is then the maximum load of any of the \gls{CN} nodes,

\begin{equation}
	\phantom{.}\rho_{CN} = \max_{n \in CN}(\rho_{n})\text{.}
\end{equation}

In this definition the performance of the \gls{CN} can limited by any one of the involved core nodes\footnote{It is worth reiterating that a \textit{node} in the \gls{3G} architecture can be implemented using separate physical machines, but is still regarded one monolithic unit for the purpose of the architecture. Refer to Section~\ref{c4:sec:3gpparchitecture} for details.}. With this model definition at hand, one can now attempt to apply it to an actual mobile network and determine the individual load values. 
% Obiger Satz ist fast identisch mit dem Beginn der nächsten subsection, Load Influencing Factors, aaaaaber: ....

One additional limitation that reflects the situation in real mobile networks has to be introduced first. 
% Hä? Oben noch "attempt to apply", hier "additional....introduced first"? Was denn jetzt?
Core network nodes should be considered as black boxes. They are custom pieces of hardware sold by vendors as-is, providing no opportunity to directly monitor the inner workings of the node, including memory and processor usage. Only the network traffic entering and leaving these nodes can be directly tapped and investigated as will be described in Section~\ref{c4:sec:methodology}. The amount of signaling traffic exchanged on these observable links gives ample opportunities to indirectly infer some of the nodes' inner state and load.

With the basics of the architecture in mind, the \gls{GGSN} can be considered a top candidate for being a load bottleneck. All traffic leaving or entering the \gls{PS} domain must pass through this element, and it is involved in all \gls{CN} \gls{gtp} signaling procedures as well. Being an endpoint for the \gls{gtp} tunnel makes it responsible to sort and encapsulate incoming traffic into the corresponding user tunnel. To accomplish this a lot of state has to be kept and processed when signaling occurs. Therefore, the \gls{GGSN} will be the node under scrutiny in the trace evaluation and performance model creation.

While looking at the \gls{GGSN} may be the most obvious choice, it is by far not the only one. In addition to \gls{gtp} tunnels the \gls{SGSN} acts as the interface to the radio network as well, which involves handling \glspl{RAB} and mobility management. However, it can be assumed that the number of \glspl{SGSN} employed in a mobile network is larger than that of \glspl{GGSN}, as they are typically kept closer to the regionally distributed radio networks. This means that a single node would have to handle less mobile devices and related signaling interactions. One has also to bear in mind that the \gls{SGSN} can be completely circumvented by setting up a direct tunnel between \gls{GGSN} and \gls{RNC}.

Apart from the two gateways directly inside the traffic path there are several other nodes essential to the control plane decision making, which may be very load-sensitive as well. The \gls{HLR} for example is a central database storing all user related information which need to be retrieved any time a user needs to undergo initial authentication and authorization. Typically, the procedures the elements are involved in are fewer. Hence, this investigation concentrates just on the case of the \gls{GGSN}.


%%
\subsection{Load Influencing Factors}

With the described understanding of core network load at hand, one can now speculate on factors that could influence the load in mobile networks. Such factors will also play an important role for the following evaluation.

The first 
%and arguably one of the most important factors 
% (Removed as biased / dubious)
factor comprises the mobile devices themselves. They are the source of any user traffic and the cause for most signaling procedures, for some procedures directly but for most indirectly. However it stands to reason that the device factor is actually an aggregate of several influence subfactors, and the specific selection of subfactors and their parametrization will be unique to each device.

Specifically, the device factor covers the type of device --- which in turn is a composite of the hardware, the baseband, and the \gls{os} --- and the running applications. The usage of applications decides when the device should establish a mobile data connection, how long the connection is held, or which mobile technology takes preference. Depending on the \gls{RAT} in use, subtle behavioral and signaling differences can be expected, e.g., in the timing of the radio transmission intervals, which could influence the investigation. Some specific 
% \gls{gtp}
tunnel duration properties could stem from the \gls{os}'s \gls{IP} and transport protocol implementation. For example, \gls{TCP} timeouts might be configured to different default values influencing the duration of transport layer connections and therefore also the underlying tunnels. Some further influence factors of the protocol stack are discussed in Section~\ref{c5:sec:stack-influences}.

The actual user-traffic patterns are also generated by the applications running on the device. The application traffic spectrum ranges from low volume but extremely long duration instant messaging applications over recurring ad-retrieval patterns up to short duration burst downloads. Since the mobile application ecosystem is very versatile every device will pose a unique combination of applications. The governing factor in everything device-related is the user and her behavioral patterns. This expresses itself both in the traffic dynamics and in the mobility pattern. But it is nigh impossible to single out individual behavior in a network's traffic mix or a large network trace.
% Warum "But"? Wo ist der Einwand?

Easier to observe are the temporal statistics of large user groups, not targeting individual users but the overall effects of device usage in a certain time span, e.g., based on the time of day or the day of the week. In network user traffic analyses diurnal effects are typically very distinct, with peak traffic some time during the day and the lowest traffic shortly after midnight. Studies investigating this usually look at user traffic only. It should prove interesting to find out if the \gls{CN} control plane shows similar patterns and can be correlated to user traffic.

The second large influence factor are the mobile network's control plane state machines and their related signaling procedures. If a network-side state machine inactivity timer decides to remove an existing tunnel, signaling will occur, which suggests there will be a noticeable number of tunnels with a duration in this range. While most \gls{3G} control plane timers have default values, they are often changed by the manufacturer or network operator, and will vary from one implementation to another. It is therefore quite difficult to give any hard numbers in advance, one has to correlate such aspects with certain events in the results.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \subsection{Factors Influencing Tunnel Durations}

% With such a dataset available and with the intent to evaluate core network signaling by looking at tunnel durations, let's first discuss some of the factors that influence this duration.

% One factor are the mobile devices themselves. The device decides when it should establish a mobile data connection, how long the connection is held, or which mobile technology takes preference. Devices can be further differentiated by their operating system and their firmware (sometimes called \textit{baseband}) which usually takes care of much of layers 1 and 2.

% Some specific tunnel durations could stem from the TCP/IP stack implementations in the operating systems of the devices. TCP timeouts might be configured to different default values in different releases of OSs. Also, mobile network firewalls have been found to interfere with transport and application-layer timeout and keep-alive or heartbeat mechanisms on mobile devices \cite{sigcomm11middleboxes}.

% Of course, the applications that run on top of the OS and generate the actual user-traffic patterns play a role as well. An example for how applications can influence network signaling is the casual game ``Angry Birds'' mentioned before. Since the application ecosystem for smartphones is extremely rich (and grows still), we cannot pinpoint individual ones from our aggregate dataset.

% An additional factor in the picture is the user and his or her behavioral patterns. They express themselves both in the traffic dynamics and in the mobility pattern, but they are rather difficult to distinguish in such a dataset given the large amount of data and the difficulty of correctly correlating tunnel management messages. We leave this as a potential future work.

% We also expect the mobile network and its protocol implementations to express themselves in the measurements. For example, the \gls{RRC} idle timer is typically in the range of 10 to 30 minutes, which could mean there will be a large number of tunnels with a duration in this range. Such choices are usually made either by the mobile network operator or the device manufacturer and can vary from one implementation to another. It is therefore quite difficult to give any hard numbers in advance, and one has to correlate such aspects with certain events in the results.

% Based on these factors, it was decided to make a first categorization according to the device type, be it either a smartphone, a regular or feature phone, or one of the many 3G dongles or mobile routers. Second, we also differentiate based on the device operating system, if known. Both differentiating aspects should prove valuable for example in deciding if currently some phone types put more signaling load on the network and to direct measures to improve this situation. Pitfalls in this differentiation are described in the next sections.



%work in 23.843 \cite{3gpp.23.843} Study on Core Network (CN) overload solutions
%GTP-C retransmission of unacknowledged requests"
%currently: semi-static DNS based load balancing (does this apply only to LTE/SGW?)